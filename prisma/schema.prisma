
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


model Profile {
  id           String     @id @default(uuid())
  clerkId      String     @unique
  firstname    String
  lastname     String
  username     String     @unique
  email        String     @unique
  address      String
  profileImage String
  birthdate    DateTime
  phonenumber  String     @unique
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Product {
  Pid           Int      @id @default(autoincrement())
  productCode   String?  @unique
  Pname         String   
  createdAt     DateTime @default(now())

  images        ProductImage[]
  Option        ProductOption[]
  variants      ProductVariant[]
  Slip          ProductSlip[]
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  url       String
  product   Product @relation(fields: [Pid], references: [Pid], onDelete: Cascade)
  Pid       Int
}

model ProductOption {
  id        Int     @id @default(autoincrement())
  name      String? // เช่น "Color", "Size", "Flavor

  product   Product @relation(fields: [Pid], references: [Pid], onDelete: Cascade)
  Pid       Int

  values    ProductOptionValue[]
}

model ProductOptionValue {
  id        Int     @id @default(autoincrement())
  value     String   // เช่น "Red", "XL", "Strawberry"

  optionId  Int
  option    ProductOption @relation(fields: [optionId], references: [id], onDelete: Cascade)

  variantValues ProductVariantValue[]
}

model ProductVariant {
  id        Int     @id @default(autoincrement())
  price     Float?
  stock     Int     @default(0)

  Pid       Int
  product   Product @relation(fields: [Pid], references: [Pid], onDelete: Cascade)

  values    ProductVariantValue[]
}

model ProductVariantValue {
  id        Int @id @default(autoincrement())

  variantId Int
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  optionValueId Int
  optionValue   ProductOptionValue @relation(fields: [optionValueId], references: [id], onDelete: Cascade)

  @@unique([variantId, optionValueId])
}

model ProductSlip {
  id          Int      @id @default(autoincrement())
  Pid         Int
  product     Product  @relation(fields: [Pid], references: [Pid], onDelete: Cascade)

  action      String   // "CREATE" | "UPDATE"
  snapshot    Json     // เก็บข้อมูลตอนนั้น (ราคา/stock/options)
  createdBy   String?  // ชื่อ user (ถ้ามี)
  createdAt   DateTime @default(now())
}

model Employee {
  id            Int      @id @default(autoincrement())
  firstname     String
  lastname      String
  email         String   @unique
  tel           String   @unique
  address       String
  gender        Gender
  dateOfBirth   DateTime
  ssn           String   @unique
  position      String
  salary        Float

  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
}

enum Gender {
  MALE
  FEMALE
  OTHER
}
